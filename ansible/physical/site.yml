---
# Make custom packages available to subsequent roles.
- hosts: webservers
  roles:
    - custom-repo
    - nginx  # Make sure to install SSL certificates.

- hosts: all
  roles:
    - crda
    - dns
    - essential-apps
    - intel-ucode
    - lm-sensors
    - locale
    - pacman-conf
    - pkgfile
    - smartd
    - time
    - user-ichimonji10

- hosts: dev-hosts
  roles:
    - dev-env
    - syncthing

- hosts: uefi-hosts
  roles:
    - uefi

- hosts: workstations
  roles:
    - borg-backup-users
    - syncthing
    - workstation

- hosts: vm-hosts
  roles:
    - libvirtd

- hosts: btrfs-hosts
  roles:
    - btrfs-balance
    - btrfs-scrub
    - btrfs-subvolume

- hosts: servers
  roles:
    - sshd

- hosts: servers:!routers
  roles:
    - netctl-generic

- hosts: apc-hosts
  roles:
    - apcupsd

- hosts: bittorrent-hosts
  roles:
    - transmission

- hosts: mnemosyne-hosts
  roles:
    - mnemosyne

- hosts: routers
  roles:
    - dynamic-dns
    - hostapd  # NOTE: Execute this play only over a wired connection.
    - netctl-routers
    - nftables-routers

# Placing the vars below into group_vars/all:!routers/vars had no effect.
- hosts: all:!routers
  roles:
    - dynamic-dns
    - nftables-generic
  vars:
    dynamic_dns_install: false

- hosts: webservers
  roles:
    - borg-backup-system
    - jellyfin
    - subsonic
